(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[10],{53:function(e,t,r){"use strict";r(1);var a=r(0);t.a=function(e){var t=e.magnify?"fa-".concat(e.magnify,"x"):"",r=["*","*","*","*","*"].map((function(r,a){return"<i data-stars=".concat(a+1,' class="').concat(e.rating>a?"fas ".concat(t," fa-star text-warning"):"far ".concat(t," fa-star text-secondary"),'"></i>')}));return Object(a.jsx)("div",{onClick:function(t){Number(e.rating)<1&&"function"===typeof e.updateRating&&e.updateRating(t.target.dataset.stars)},dangerouslySetInnerHTML:{__html:r.join("")}})}},85:function(e,t,r){"use strict";r.r(t);var a=r(2),s=r(8),c=r.n(s),n=r(12),o=r(3),i=r(1),l=r(6),d="https://js.stripe.com/v3",u=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,j="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",b=null,p=function(e){return null!==b?b:b=new Promise((function(t,r){if("undefined"!==typeof window)if(window.Stripe&&e&&console.warn(j),window.Stripe)t(window.Stripe);else try{var a=function(){for(var e=document.querySelectorAll('script[src^="'.concat(d,'"]')),t=0;t<e.length;t++){var r=e[t];if(u.test(r.src))return r}return null}();a&&e?console.warn(j):a||(a=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",r=document.createElement("script");r.src="".concat(d).concat(t);var a=document.head||document.body;if(!a)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return a.appendChild(r),r}(e)),a.addEventListener("load",(function(){window.Stripe?t(window.Stripe):r(new Error("Stripe.js not available"))})),a.addEventListener("error",(function(){r(new Error("Failed to load Stripe.js"))}))}catch(s){return void r(s)}else t(null)}))},h=function(e,t,r){if(null===e)return null;var a=e.apply(void 0,t);return function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"1.13.2",startTime:t})}(a,r),a},O=Promise.resolve().then((function(){return p(null)})),x=!1;O.catch((function(e){x||console.warn(e)}));var m,f=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];x=!0;var a=Date.now();return O.then((function(e){return h(e,t,a)}))},g=r(52),v=r(5),y=r(14),E=r(26),w=r(53),S=r(31),R=r(32),A=r(9),k=(r(33),r(0)),C=null;t.default=function(){var e=Object(v.b)(),t=Object(o.a)(e,2),r=t[0],s=r.order,d=r.items,u=r.cart,j=r.org,b=r.userId,p=t[1],h=Object(i.useState)(!1),O=Object(o.a)(h,2),x=O[0],I=O[1],D=Object(i.useState)(!1),P=Object(o.a)(D,2),N=P[0],T=P[1],_=Object(i.useState)(""),F=Object(o.a)(_,2),L=(F[0],F[1]),U=Object(l.h)(),M=U.restoUrl,W=U.orderResult,Y=Object(i.useRef)(),G="",q=Object(i.useRef)(),B=Object(i.useRef)({});if(j.coords){var H=j.coords.replace(" ","").split(","),V=Object(o.a)(H,2),J=V[0],z=V[1];J=Number(J),z=Number(z),G="".concat(z-.01,",").concat(J-.01,",").concat(z+.01,",").concat(J+.01)}function K(){return Q.apply(this,arguments)}function Q(){return(Q=Object(n.a)(c.a.mark((function e(){var t,r,a,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(y.a)("/api/order/".concat(M,"/").concat(localStorage.orderCode));case 2:t=e.sent,r=t.status,a=t.data,s=t.message,console.log("[checkOrderStatus] url(".concat(M,") status(").concat(r,") message(").concat(s,") userItems:"),a),p({type:"USER_SESSION_ORDER",data:a,message:s}),a&&a.order&&a.order.status&&["CANCELLED","ABANDONED","COMPLETED"].indexOf(a.order.status)>-1&&m&&(console.log("~ clearing interval checker"),clearInterval(m));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(){return($=Object(n.a)(c.a.mark((function e(){var t,r,a,s,n,o,i,l,d,b,h,O;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[loadPage] org",j),t={},e.next=4,Object(y.a)("/api/order/".concat(localStorage.orderCode||""),"post",u);case 4:if(r=e.sent,a=r.status,s=r.data,n=r.message,console.log("[loadPage] url(".concat(M,") status(").concat(a,") message(").concat(n,") localStorage.orderCode(").concat(localStorage.orderCode,") userItems:"),s),console.log(" ORER DATA: /api/order/".concat(localStorage.orderCode||""),s),a&&s.order.status){e.next=15;break}return I(!0),delete localStorage.orderCode,p({type:"UPDATE_REDIRECT_GO",redirectUrl:"/".concat(M),message:"Something didn't work, let's try again!"}),e.abrupt("return");case 15:if(t=s,"complete"!==W){e.next=28;break}return o=new URLSearchParams(window.location.search).get("transId"),e.next=20,Object(y.a)("/api/stripe/checkout-status?sessionId=".concat(o));case 20:i=e.sent,l=i.status,d=i.data,b=i.message,l&&d&&(t.order=d),p({type:"USER_SESSION_ORDER_PAID",redirectUrl:"/".concat(M,"/order"),data:t,message:b}),e.next=31;break;case 28:"AWAIT_PAYMENT"===(h=s.order).status||"AWAIT_INFO"===h.status?(h.orderCode&&(console.log(" .. saving orderCode to localStorage! ".concat(h.orderCode)),localStorage.orderCode=h.orderCode,localStorage.cart=JSON.stringify(h.cart),O="https://chart.googleapis.com/chart?chs=500x500&cht=qr&choe=UTF-8&chl=".concat(h.orderCode),console.log("qrCode='".concat(O,"'")),L(O)),"AWAIT_PAYMENT"!==h.status||W||Z(null,h.subtotal)):"PREPARING"!==h.status&&"READY"!==h.status||(console.log("~ starting check timer"),m&&clearInterval(m),m=setInterval(K,15e3)),p({type:"USER_SESSION_ORDER",data:t,message:n});case 31:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(){return(X=Object(n.a)(c.a.mark((function e(t){var r,s,n,o,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),q.current.checkValidity()){e.next=4;break}return q.current.classList.add("was-validated"),e.abrupt("return");case 4:return r={},["name","email","phone","note"].forEach((function(e){r[e]=B.current[e].value})),console.log("appending user details - '/api/order/userdetails' with:",r),e.next=10,Object(y.a)("/api/order/userdetails/".concat(localStorage.orderCode),"put",r);case 10:if(s=e.sent,n=s.status,o=s.data,i=s.message,console.log("[paymentInfoCapture] - order:",o),n){e.next=18;break}return p({type:"ALERT_MESSAGE",message:i}),e.abrupt("return");case 18:p({type:"USER_SESSION_ORDER",data:Object(a.a)({},o),message:i});case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return ee.apply(this,arguments)}function ee(){return(ee=Object(n.a)(c.a.mark((function e(t){var r,a,n,o,i,l=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.length>1&&void 0!==l[1]?l[1]:0,t&&t.preventDefault(),console.log("[initPayment]"),T(!0),e.next=6,Object(y.a)("/api/stripe/config/");case 6:return a=e.sent,n=a.publicKey,a.currency,e.next=11,Object(y.a)("/api/stripe/checkout","post",{subtotal:r||s.subtotal});case 11:return o=e.sent,i=o.sessionId,e.next=15,f(n);case 15:return C=e.sent,e.next=18,C.redirectToCheckout({sessionId:i});case 18:e.sent,T(!1);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(e){return re.apply(this,arguments)}function re(){return(re=Object(n.a)(c.a.mark((function e(t){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),console.log("restarting to orders.... "),!localStorage.orderCode){e.next=8;break}return e.next=5,Object(y.a)("/api/order/restart/".concat(localStorage.orderCode),"put",{});case 5:r=e.sent,r.status,r.message;case 8:delete localStorage.orderCode,delete localStorage.cart,p({type:"UPDATE_REDIRECT_GO",redirectUrl:"/".concat(M)});case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ae(){return(ae=Object(n.a)(c.a.mark((function e(t){var r,s,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(y.a)("/api/order/rating/".concat(localStorage.orderCode),"put",{rating:t});case 2:r=e.sent,r.status,s=r.data,n=r.message,console.log("[updateRating] - order:",s),p({type:"USER_SESSION_ORDER",data:Object(a.a)(Object(a.a)({},s),{},{rating:t}),message:n});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function se(){return(se=Object(n.a)(c.a.mark((function e(t){var r,a,s,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),!((r=Y.current.value.trim()).length<3)){e.next=4;break}return e.abrupt("return");case 4:return Y.current.value="",e.next=7,Object(y.a)("/api/order/notes/".concat(localStorage.orderCode),"put",{note:r});case 7:a=e.sent,a.status,s=a.data,n=a.message,console.log("incoming orde info: ",s),p({type:"USER_SESSION_ORDER",data:{order:s},message:n});case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(i.useEffect)((function(){!function(){$.apply(this,arguments)}()}),[]),Object(k.jsx)(k.Fragment,{children:x?Object(k.jsxs)("div",{class:"alert alert-danger mt-5",children:[Object(k.jsx)("i",{class:"fas fa-shopping-cart fa-6x float-end"}),Object(k.jsx)("h1",{class:"mt-2",children:"We had a problem with that link. Please check you typed it correctly!"})]}):Object(k.jsxs)(k.Fragment,{children:[Object(k.jsxs)("div",{id:"menu-banner",className:"p-4 p-md-5 text-white rounded ".concat(j.imageMenuBanner?"":"bg-dark"),children:[Object(k.jsx)("div",{id:"menu-banner-bg",style:j.imageMenuBanner&&{backgroundImage:"url(".concat(j.imageMenuBanner,")")}}),Object(k.jsxs)("div",{class:"col-md-6 px-0",children:[Object(k.jsx)("h1",{class:"display-4",children:j.name}),Object(k.jsx)("p",{class:"text-muted",children:j.info})]})]}),Object(k.jsxs)("div",{class:"mx-3 text-dark border-bottom row",children:[Object(k.jsxs)("div",{class:"col-12 col-md-4 col-lg-3",children:[Object(k.jsx)("i",{class:"fas fa-phone-alt ml-3"})," ",Object(k.jsx)("a",{href:"tel:".concat(j.phone),children:j.phone})]}),Object(k.jsx)("div",{class:"col-12 col-md-4 col-lg-3",children:Object(k.jsx)(S.a,{})}),Object(k.jsx)("div",{class:"col-12 col-md-4 col-lg-6",children:Object(k.jsx)(R.a,{})})]}),Object(k.jsxs)("div",{class:"row",children:[Object(k.jsx)("div",{class:"col-12 col-md-6 mb-3",children:Object(k.jsxs)("div",{class:"card",children:[Object(k.jsx)("div",{class:"card-header",children:Object(k.jsxs)("h3",{children:["Order #: ",s.orderCode]})}),Object(k.jsxs)("div",{class:"card-body",children:[Object(k.jsxs)("h4",{children:[("CANCELLED"===s.status||"ABANDONED"===s.status)&&Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)("i",{class:"fa fa-pause-circle text-danger"})," Order Cancelled"]}),"COMPLETED"===s.status&&Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)("i",{class:"fa fa-check-circle text-success"})," Order Completed!"]}),"AWAIT_PAYMENT"===s.status&&Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)("i",{class:"fa fa-pause-circle text-danger"})," Payment Needed First"]}),"AWAIT_INFO"===s.status&&Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)("i",{class:"fa fa-pause-circle text-danger"})," Order Details Needed"]}),"SCHEDULED"===s.status&&Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)("i",{class:"fa fa-check-circle text-success"})," Order Scheduled for ",s.deliverAt," "]}),"PREPARING"===s.status&&Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)("i",{class:"fas fa-circle-notch text-secondary"})," Preparing Order "]}),"READY"===s.status&&Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)("i",{class:"fa fa-check-circle text-success"})," Order Ready for Pickup "]}),"DELIVERING"===s.status&&Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)("i",{class:"fa fa-circle text-success"})," Order Out for Delivery "]})]}),["SCHEDULED","PREPARING","READY","DELIVERING"].indexOf(s.status)>-1&&s.statusInfo&&Object(k.jsx)("h5",{class:"text-warning",children:Object(k.jsx)("i",{children:s.statusInfo})}),"COMPLETED"===s.status&&Object(k.jsxs)("div",{class:"mt-3",children:[Object(k.jsx)("p",{children:"We hope you enjoyed your order!"}),Object(k.jsx)("p",{children:"Please rate your order & service:"}),Object(k.jsx)(w.a,{rating:s.rating,magnify:3,updateRating:function(e){return ae.apply(this,arguments)}})]}),Object(k.jsxs)("div",{class:"mt-3",children:[["ABANDONED","CANCELLED","COMPLETED"].indexOf(s.status)>-1&&Object(k.jsx)(k.Fragment,{children:Object(k.jsxs)("button",{onClick:te,class:"btn btn-success",children:[Object(k.jsx)("i",{class:"fas fa-sync-alt"})," New Order"]})}),"AWAIT_PAYMENT"===s.status&&!N&&Object(k.jsxs)(k.Fragment,{children:[Object(k.jsxs)("button",{onClick:Z,class:"btn btn-warning",children:[Object(k.jsx)("i",{class:"fas fa-credit-card"})," Complete Payment"]}),Object(k.jsx)("div",{class:"mt-3",children:Object(k.jsx)("small",{children:"Or cancel order:"})}),Object(k.jsxs)("button",{onClick:te,class:"btn btn-outline-secondary",children:[Object(k.jsx)("i",{class:"fas fa-sync-alt"})," Cancel Order"]})]}),"AWAIT_PAYMENT"===s.status&&N&&Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)("h2",{class:"spinner-border text-warning",children:"\xa0"}),Object(k.jsx)("h4",{children:"Please Wait Loading..."})]}),"AWAIT_INFO"===s.status&&Object(k.jsxs)("form",{ref:q,class:"form-signin",children:[Object(k.jsx)("p",{children:"Please verify your order before finalizing this, it will be to the right or below this form."}),Object(k.jsx)("p",{children:"Please enter your contact details to proceed:"}),Object(k.jsxs)("div",{class:"mb-3",children:[Object(k.jsx)("label",{for:"name",children:"Your Name"}),Object(k.jsx)("input",{ref:function(e){return B.current.name=e},type:"text",id:"name",class:"form-control",required:!0}),Object(k.jsx)("div",{class:"invalid-feedback",children:"Please enter your name"})]}),Object(k.jsxs)("div",{class:"mb-3",children:[Object(k.jsx)("label",{for:"name",children:"Email"}),Object(k.jsx)("input",{ref:function(e){return B.current.email=e},type:"text",id:"email",class:"form-control",required:!0}),Object(k.jsx)("div",{class:"invalid-feedback",children:"Please enter your email to receive updates"})]}),Object(k.jsxs)("div",{class:"mb-3",children:[Object(k.jsx)("label",{for:"name",children:"Phone"}),Object(k.jsx)("input",{ref:function(e){return B.current.phone=e},type:"text",id:"phone",class:"form-control",required:!0}),Object(k.jsx)("div",{class:"invalid-feedback",children:"Please enter your mobile phone so we can reach you before preparing."})]}),Object(k.jsxs)("div",{class:"mb-3",children:[Object(k.jsx)("label",{for:"note",class:"form-label",children:"Anything Else? Attach Message"}),Object(k.jsx)("textarea",{ref:function(e){return B.current.note=e},id:"note",class:"form-control",rows:"2"})]}),Object(k.jsxs)("div",{class:"card-footer",children:[Object(k.jsx)("button",{onClick:function(e){return X.apply(this,arguments)},class:"btn btn-primary mx-1",children:"Start Order"}),Object(k.jsx)("button",{onClick:te,class:"float-end btn btn-outline-secondary",children:"Cancel"})]})]}),["PREPARING","READY"].indexOf(s.status)>-1&&Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)("a",{target:"_blank",href:j.coords?"https://www.google.com/maps/search/?api=1&query=".concat(j.coords):"https://www.google.com/maps?q=".concat(encodeURIComponent(j.address)),rel:"noreferrer",children:Object(k.jsxs)("small",{class:"text-muted",children:["Pickup at ",j.address]})}),j.coords&&Object(k.jsx)("iframe",{class:"w-100 h-50",title:"Map",frameborder:"0",scrolling:"no",marginheight:"0",marginwidth:"0",src:"https://www.openstreetmap.org/export/embed.html?bbox=".concat(G,"&layer=mapnik&marker=").concat(j.coords)})]})]}),["SCHEDULED","PREPARING","READY","DELIVERING"].indexOf(s.status)>-1&&Object(k.jsxs)(k.Fragment,{children:[Object(k.jsxs)("h5",{class:"text-primary mt-3",children:[Object(k.jsx)("i",{class:"fas fa-comments"})," Order Updates"]}),s.notes&&s.notes.map((function(e){return Object(k.jsx)(k.Fragment,{children:e.userId===b?Object(k.jsxs)("div",{class:"text-secondary",children:[Object(k.jsx)("i",{class:"fas fa-comments",title:g.DateTime.fromSeconds(e.timestamp-1).toRelative()})," ",e.note]}):Object(k.jsxs)("div",{class:"text-primary",children:[Object(k.jsx)("i",{class:"fas fa-reply",title:g.DateTime.fromSeconds(e.timestamp-1).toRelative()})," ",e.note]})})})),Object(k.jsxs)("div",{class:"input-group",children:[Object(k.jsx)("input",{ref:Y,type:"text",class:"form-control",placeholder:"Ask Question"}),Object(k.jsx)("button",{onClick:function(e){return se.apply(this,arguments)},class:"btn btn-primary",children:Object(k.jsx)("i",{class:"fas fa-comments"})})]})]})]})]})}),Object(k.jsx)("div",{class:"col-12 col-md-6",children:Object(k.jsxs)("div",{class:"shopping-cart card",children:[Object(k.jsx)("div",{class:"card-header",children:Object(k.jsx)("h3",{children:"Order Items"})}),u.length>0?Object(k.jsx)(k.Fragment,{children:Object(k.jsxs)("div",{class:"card-body",children:[u.map((function(e){return Object(k.jsx)(E.a,{items:d,cartItem:e})})),Object(k.jsx)("div",{class:"row",children:Object(k.jsxs)("div",{class:"col item-layout mt-3 mb-1",children:["Subtotal",Object(k.jsx)("div",{class:"item-total",children:Object(k.jsx)("span",{class:"badge rounded-pill bg-light text-dark mx-3",children:s.subtotal?Object(A.a)(s.subtotal):"-"})})]})}),Object(k.jsx)("div",{class:"row",children:Object(k.jsxs)("div",{class:"col item-layout mb-1",children:[s.taxName||"Tax",Object(k.jsx)("div",{class:"item-total",children:Object(k.jsx)("span",{class:"badge rounded-pill bg-light text-dark mx-3",children:s.tax?Object(A.a)(s.tax):"-"})})]})}),Object(k.jsx)("div",{class:"row",children:Object(k.jsxs)("div",{class:"col item-layout mb-1",children:[Object(k.jsx)("strong",{children:"Total"}),Object(k.jsx)("div",{class:"item-total",children:Object(k.jsx)("span",{class:"badge rounded-pill bg-light text-dark mx-3",children:s.total?Object(A.a)(s.total):"-"})})]})})]})}):Object(k.jsxs)("div",{class:"card-body text-secondary",children:[Object(k.jsx)("i",{class:"fas fa-book-reader fa-4x text-warning float-start mx-3"}),"Yumm... Nothing in order!"]})]})})]})]})})}}}]);
//# sourceMappingURL=10.82f0a30b.chunk.js.map